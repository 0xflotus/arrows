<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="lib/d3.js"></script>
<title>Arrow Tool</title>
</head>
<body>  

<h1>Arrow Tool</h1>
<button id="button-newnode">Create Node</button>
<button id="button-newrelationship">Create Relationship</button>

<div id="canvas"></div>

<script type="text/javascript">

// A maximum of 2 objects can be selected at any time
var selectedObjects = [];

var relationships = [];

var svg = d3.select("#canvas")
    .append("svg:svg")
    .attr("width", 1024)
    .attr("height", 768);


var createNode = function() {
  var node = svg.append("svg:circle")
      .attr("cx", 50)
      .attr("cy", 140)
      .attr("r", 40)
      .attr("fill", "blue")
      .call(d3.behavior.drag().on("drag", move));
      
  node.on("click", function() {
    selectedObjects.push(node);
    if (selectedObjects.length > 2) {
      selectedObjects.shift();
    }
    console.log(selectedObjects);
  })
}


var drawRelationships = function() {
  for (var i = 0; i < relationships.length; i++) {
    var relationship = relationships[i];
    var path = {
      x1: relationship.start.attr("cx"),
      y1: relationship.start.attr("cy"),
      x2: relationship.end.attr("cx"),
      y2: relationship.end.attr("cy"),
    };
    svg.append("svg:path").attr("d", "M" + path.x1 + " " + path.y1 + "L" + path.x2 + " " + path.y2)
      .style("stroke", "black")
      .style("stroke-width", 2);
  }
}

var createRelationship = function() {
  if (selectedObjects.length == 2) {
    relationships.push({ 
      type: "KNOWS", 
      start: selectedObjects[0], 
      end: selectedObjects[1]
    });
  }
  drawRelationships();
}



createNode();
d3.select("#button-newnode").on("click", createNode);
d3.select("#button-newrelationship").on("click", createRelationship);
    
    
function move(){
    var dragTarget = d3.select(this);
    dragTarget
        .attr("cx", function(){return d3.event.dx + parseInt(dragTarget.attr("cx"))})
        .attr("cy", function(){return d3.event.dy + parseInt(dragTarget.attr("cy"))});
};

</script>
   
</body>
</html>